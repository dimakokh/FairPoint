<!doctype html>

<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Kitchen Board — Показ заказов</title>

<!-- Firebase COMPAT -->

<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>

<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>

<style>
:root{
  --bg:#f6f7f9;
  --card:#ffffff;
  --border:#e6e8ec;
  --text:#1f2328;
  --muted:#6b7280;
  --accent:#b23a48;      /* светло-бордовый */
  --accent-soft:#8e3a63; /* бордово-фиолетовый */
  --ready:#d94a5a;
  --shadow:0 6px 18px rgba(0,0,0,0.08);
  font-family:Inter,"Segoe UI",Roboto,Arial;
}

html,body{
  margin:0;
  background:var(--bg);
  color:var(--text);
}

.container{
  max-width:1200px;
  margin:24px auto;
  padding:16px;
}

header{
  display:flex;
  align-items:center;
  gap:16px;
}

.logo{
  width:52px;height:52px;
  border-radius:14px;
  background:linear-gradient(135deg,var(--accent),var(--accent-soft));
  color:#fff;
  display:flex;align-items:center;justify-content:center;
  font-weight:700;font-size:18px;
}

h1{margin:0;font-size:20px;}
.lead{color:var(--muted);font-size:13px;}

.board{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:18px;
  margin-top:20px;
}

.column{
  background:var(--card);
  border-radius:16px;
  padding:16px;
  box-shadow:var(--shadow);
  border:1px solid var(--border);
}

.col-title{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:12px;
}

.col-title h2{margin:0;font-size:16px;}
.col-count{
  background:#f0f1f4;
  padding:6px 10px;
  border-radius:10px;
  font-weight:700;
  font-size:13px;
}

.list{display:flex;flex-direction:column;gap:12px;}

.card{
  display:flex;
  align-items:center;
  justify-content:space-between;
  padding:12px 14px;
  border-radius:14px;
  border:1px solid var(--border);
  background:#fff;
}

.card.ready{
  border-left:5px solid var(--ready);
}

.card-left{
  display:flex;
  align-items:center;
  gap:14px;
}

.status-dot{
  width:12px;height:12px;border-radius:50%;
  background:var(--accent);
}

.card.ready .status-dot{
  background:var(--ready);
}

.order-number{
  font-size:20px;
  font-weight:700;
}

.details .title{font-size:15px;}
.details .meta{font-size:13px;color:var(--muted);}

button{
  border:0;
  padding:8px 12px;
  border-radius:10px;
  cursor:pointer;
  background:linear-gradient(90deg,var(--accent),var(--accent-soft));
  color:#fff;
  font-weight:600;
}

@media(max-width:900px){
  .board{grid-template-columns:1fr;}
}
</style>

</head>
<body>

<div class="container">
<header>
  <div class="logo">KB</div>
  <div>
    <h1>Kitchen Board</h1>
    <div class="lead">Светлая тема · Firebase · реальное время</div>
  </div>
</header>

<div class="board">
  <section class="column">
    <div class="col-title">
      <h2>Готовится</h2>
      <div class="col-count" id="countCooking">0</div>
    </div>
    <div class="list" id="listCooking"></div>
  </section>

  <section class="column">
    <div class="col-title">
      <h2>Готово</h2>
      <div class="col-count" id="countReady">0</div>
    </div>
    <div class="list" id="listReady"></div>
  </section>
</div>
</div>

<script>
/* ===== Firebase ===== */
const firebaseConfig = {
  apiKey: "AIzaSyCSw_6Lv22XH-jwK3NN6B6QHH_UCa6Sn1s",
  authDomain: "fairpay-fast.firebaseapp.com",
  databaseURL: "https://fairpay-fast-default-rtdb.firebaseio.com",
  projectId: "fairpay-fast",
  storageBucket: "fairpay-fast.appspot.com",
  messagingSenderId: "764987626490",
  appId: "1:764987626490:web:e3451c8162f6992449ca43"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database().ref('orders');

const listCooking = document.getElementById('listCooking');
const listReady = document.getElementById('listReady');
const countCooking = document.getElementById('countCooking');
const countReady = document.getElementById('countReady');

const AUTO_EXPIRE_MS = 2 * 60 * 1000;
const timers = new Map();

function speak(text){
  const u = new SpeechSynthesisUtterance(text);
  u.lang = 'ru-RU';
  speechSynthesis.cancel();
  speechSynthesis.speak(u);
}

function clearTimer(key){
  if(timers.has(key)){
    clearTimeout(timers.get(key));
    timers.delete(key);
  }
}

function renderCard(key,o){
  const c=document.createElement('div');
  c.className='card'+(o.status==='ready'?' ready':'');

  const left=document.createElement('div');
  left.className='card-left';

  const dot=document.createElement('div');
  dot.className='status-dot';

  const num=document.createElement('div');
  num.className='order-number';
  num.textContent=o.orderNumber||key;

  const det=document.createElement('div');
  det.className='details';
  det.innerHTML=`<div class="title">${o.items?.map(i=>i.name).join(', ')||'Заказ'}</div>
                 <div class="meta">Терминал: ${o.terminalId||'—'}</div>`;

  left.append(dot,num,det);
  c.appendChild(left);

  if(o.status!=='ready'){
    const b=document.createElement('button');
    b.textContent='Готово';
    b.onclick=()=>db.child(key).update({status:'ready',timeReady:Date.now()});
    c.appendChild(b);
  }

  return c;
}

function render(snapshot){
  listCooking.innerHTML='';
  listReady.innerHTML='';
  let c=0,r=0;

  snapshot.forEach(s=>{
    const o=s.val();
    if(o.status==='ready'){
      listReady.appendChild(renderCard(s.key,o));
      r++;
    }else{
      listCooking.appendChild(renderCard(s.key,o));
      c++;
    }
  });

  countCooking.textContent=c;
  countReady.textContent=r;
}

db.on('value', render);

db.on('child_changed', snap=>{
  const o=snap.val();
  if(o.status==='ready'){
    speak(`Заказ номер ${o.orderNumber} готов`);
    clearTimer(snap.key);
    timers.set(snap.key,setTimeout(()=>db.child(snap.key).remove(),AUTO_EXPIRE_MS));
  }
});
</script>

</body>
</html>
