<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>FairPoint ‚Äî –ö–∞—Å—Å–∞ / –ö—É—Ö–Ω—è</title>

<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>

<style>
:root{
  --bg:#f7f7f8;
  --card:#ffffff;
  --muted:#666;
  --accent:#ff7a45;
  --accent-dark:#d9480f;
  --success:#52c41a;
  --danger:#ff4d4f;
  --packing:#1677ff;
  --shadow:0 6px 18px rgba(0,0,0,0.08);
  font-family:Inter,Segoe UI,Roboto,Arial,sans-serif;
}
html,body{margin:0;height:100%;background:var(--bg);}
.wrap{max-width:1200px;margin:20px auto;padding:18px;}
header{display:flex;align-items:center;gap:16px;}
.logo{width:56px;height:56px;border-radius:10px;background:linear-gradient(135deg,var(--accent),var(--accent-dark));display:flex;align-items:center;justify-content:center;color:#fff;font-weight:800}
.top-controls{margin-left:auto;display:flex;gap:12px;align-items:center}
.panel{background:var(--card);border-radius:12px;padding:12px;box-shadow:var(--shadow)}
.grid{display:grid;grid-template-columns:1fr 320px;gap:12px}
.list{display:flex;flex-direction:column;gap:8px;max-height:65vh;overflow:auto}
.req{display:flex;justify-content:space-between;gap:12px;padding:12px;border-radius:10px;border:1px solid #eee;cursor:pointer}
.code{font-weight:800;font-size:18px;background:linear-gradient(90deg,var(--accent),var(--accent-dark));color:#fff;padding:6px 10px;border-radius:8px}
.amount{font-weight:800}
.badge{padding:4px 8px;border-radius:6px;font-size:12px}
.badge.cooking{background:#fff3e0;color:#d9480f}
.badge.packing{background:#e6f4ff;color:#1677ff}
.badge.ready{background:#f6ffed;color:#389e0d}
button{padding:8px 12px;border-radius:8px;border:none;cursor:pointer;font-weight:700}
button.gray{background:#eee}
button.red{background:var(--danger);color:#fff}
button.accent{background:var(--accent);color:#fff}
.empty{text-align:center;color:var(--muted);padding:24px}

.switch{display:flex;gap:6px}
.switch button{background:#eee}
.switch button.active{background:var(--accent);color:#fff}

/* FireDome */
#fireDome{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.85);
  color:#fff;
  display:none;
  align-items:center;
  justify-content:center;
  font-size:42px;
  font-weight:900;
  z-index:2000;
}
</style>
</head>

<body>
<div id="fireDome">üî• –¢–≤–æ–π –∑–∞–∫–∞–∑ –∑–¥–µ—Å—å</div>

<div class="wrap">
<header>
  <div class="logo">FP</div>
  <h1>FairPoint</h1>
  <div class="top-controls">
    <div class="switch">
      <button id="modeCash" class="active">–ö–∞—Å—Å–∞</button>
      <button id="modeKitchen">–ö—É—Ö–Ω—è</button>
    </div>
  </div>
</header>

<div class="grid">
  <div class="panel">
    <div style="font-weight:800;margin-bottom:8px" id="listTitle">–û–∂–∏–¥–∞—é—Ç –Ω–∞–ª–∏—á–Ω–æ–π –æ–ø–ª–∞—Ç—ã</div>
    <div class="list" id="ordersList"></div>
    <div class="empty" id="emptyText">–ù–µ—Ç –∑–∞–∫–∞–∑–æ–≤</div>
  </div>

  <div class="panel">
    <div style="font-weight:800">–õ–æ–≥</div>
    <div id="log" style="font-size:13px;color:var(--muted)"></div>
  </div>
</div>
</div>

<script>
const FIREBASE_CONFIG={
 apiKey:"AIzaSyABvY_6cHonbLvdBj5cYMSheJDLMd_-bNw",
 authDomain:"app-fairpay.firebaseapp.com",
 databaseURL:"https://app-fairpay-default-rtdb.firebaseio.com",
 projectId:"app-fairpay",
 appId:"1:29576302334:web:0e559f804bf62c59981faf"
};

firebase.initializeApp(FIREBASE_CONFIG);
const db=firebase.database();
const ordersRef=db.ref("orders");

let mode="cash";
const orders=new Map();

const list=document.getElementById("ordersList");
const empty=document.getElementById("emptyText");
const title=document.getElementById("listTitle");
const fireDome=document.getElementById("fireDome");

document.getElementById("modeCash").onclick=()=>setMode("cash");
document.getElementById("modeKitchen").onclick=()=>setMode("kitchen");

function setMode(m){
 mode=m;
 document.getElementById("modeCash").classList.toggle("active",m==="cash");
 document.getElementById("modeKitchen").classList.toggle("active",m==="kitchen");
 title.textContent=m==="cash"?"–û–∂–∏–¥–∞—é—Ç –Ω–∞–ª–∏—á–Ω–æ–π –æ–ø–ª–∞—Ç—ã":"–ö—É—Ö–Ω—è";
 render();
}

function log(t){
 const d=document.createElement("div");
 d.textContent=new Date().toLocaleTimeString()+" ‚Äî "+t;
 document.getElementById("log").prepend(d);
}

function render(){
 list.innerHTML="";
 let shown=0;
 orders.forEach((o,k)=>{
   if(mode==="cash" && !(o.paymentType==="cash" && o.status==="waiting_for_cash")) return;
   if(mode==="kitchen" && o.status!=="cooking" && o.status!=="packing") return;

   shown++;
   const el=document.createElement("div");
   el.className="req";

   let badge="";
   if(o.status==="cooking") badge='<span class="badge cooking">–ì–æ—Ç–æ–≤–∏—Ç—Å—è</span>';
   if(o.status==="packing") badge='<span class="badge packing">–ü–∞–∫—É–µ—Ç—Å—è</span>';

   el.innerHTML=`
     <div>
       <div class="code">${o.orderNumber}</div>
       ${badge}
     </div>
     <div class="amount">${o.amount||""}</div>
   `;

   if(mode==="kitchen"){
     el.onclick=()=>cycleStatus(k,o);
   }

   list.appendChild(el);
 });
 empty.style.display=shown? "none":"block";
}

function cycleStatus(key,order){
 let next;
 if(order.status==="cooking") next="packing";
 else if(order.status==="packing") next="ready";
 else return;

 ordersRef.child(key).update({status:next},()=>{
   log(`–ó–∞–∫–∞–∑ ${order.orderNumber} ‚Üí ${next}`);
   if(next==="ready"){
     fireDome.style.display="flex";
     setTimeout(()=>fireDome.style.display="none",3000);
   }
 });
}

ordersRef.on("child_added",s=>{
 orders.set(s.key,s.val());
 render();
});

ordersRef.on("child_changed",s=>{
 orders.set(s.key,s.val());
 render();
});
</script>
</body>
</html>
